---
import {
  mdiAlert,
  mdiAlertCircle,
  mdiChevronRight,
  mdiFlask,
  mdiInformation,
  mdiLightbulbOn,
  mdiVideo,
} from '@mdi/js';
import MdiIcon from './MdiIcon.astro';

/**
 * Custom Aside component with styled header and optional collapse
 *
 * Usage:
 * <Aside type="tip">Content here</Aside>
 * <Aside type="note" title="Custom Title">Content here</Aside>
 * <Aside type="caution" collapse>Collapsible content here</Aside>
 */

interface Props {
  type?: 'note' | 'tip' | 'caution' | 'danger' | 'example';
  title?: string;
  collapse?: boolean;
}

const { type = 'note', title, collapse = false } = Astro.props;

const titles: Record<string, string> = {
  note: 'Note',
  tip: 'Tip',
  caution: 'Warning',
  danger: 'Danger',
  example: 'Example',
  video: 'Video',
};

const displayTitle = title || titles[type] || 'Note';

const iconPaths: Record<string, string> = {
  note: mdiInformation,
  tip: mdiLightbulbOn,
  caution: mdiAlert,
  danger: mdiAlertCircle,
  example: mdiFlask,
  video: mdiVideo,
};
---

{collapse ? (
  <details class={`aside aside--${type}`}>
    <summary>
      <span class="aside-icon"><MdiIcon path={iconPaths[type] || mdiInformation} size={20} /></span>
      <span class="aside-title">{displayTitle}</span>
      <MdiIcon class="aside-chevron" path={mdiChevronRight} size={20} />
    </summary>
    <div class="aside-content">
      <slot />
    </div>
  </details>
) : (
  <div class={`aside aside--${type}`}>
    <div class="aside-header">
      <span class="aside-icon"><MdiIcon path={iconPaths[type] || mdiInformation} size={20} /></span>
      <span class="aside-title">{displayTitle}</span>
    </div>
    <div class="aside-content">
      <slot />
    </div>
  </div>
)}

<style>
  .aside {
    margin: 1rem 0;
    border-radius: 0.375rem;
    overflow: hidden;
    border: none;
    background: var(--aside-bg);
  }

  /* Type-specific colors */
  .aside--tip {
    --aside-bg: rgba(74, 222, 128, 0.12);
    --aside-title-color: #4ade80;
  }

  .aside--note {
    --aside-bg: rgba(45, 212, 191, 0.12);
    --aside-title-color: #2dd4bf;
  }

  .aside--caution {
    --aside-bg: rgba(251, 191, 36, 0.12);
    --aside-title-color: #fbbf24;
  }

  .aside--danger {
    --aside-bg: rgba(248, 113, 113, 0.12);
    --aside-title-color: #f87171;
  }

  .aside--example {
    --aside-bg: rgba(192, 132, 252, 0.12);
    --aside-title-color: #c084fc;
  }

  .aside--video {
    --aside-bg: rgb(32, 148, 243, 0.12);
    --aside-title-color: rgb(32, 148, 243);
  }

  .aside-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    font-weight: 600;
    font-size: 0.9rem;
  }

  .aside-icon {
    display: flex;
    align-items: center;
    color: var(--aside-title-color);
  }

  .aside-title {
    flex: 1;
    color: var(--aside-title-color);
  }

  .aside-content {
    margin-top: 0;
    padding: 0 1rem 0.75rem 1rem;
    color: var(--sl-color-gray-2);
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .aside-content :global(p:first-child) {
    margin-top: 0;
  }

  .aside-content :global(p:last-child) {
    margin-bottom: 0;
  }

  /* Collapsible styles */
  details.aside {
    cursor: default;
    padding: 0;
  }

  details.aside > summary {
    cursor: pointer;
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    font-weight: 600;
    font-size: 0.9rem;
  }

  details.aside > summary::-webkit-details-marker,
  details.aside > summary::marker {
    display: none !important;
    content: none !important;
    list-style: none !important;
    font-size: 0 !important;
    width: 0 !important;
    height: 0 !important;
  }

  details.aside > summary {
    list-style-type: none !important;
  }

  details.aside > summary::before {
    display: none !important;
    content: none !important;
  }

  details.aside > summary:focus {
    outline: none;
  }

  .aside-chevron {
    transition: transform 0.2s ease;
    color: var(--sl-color-gray-3);
    margin-left: auto;
  }

  details.aside[open] .aside-chevron {
    transform: rotate(90deg);
  }

  details.aside:not([open]) .aside-content {
    display: none;
  }

  /* Light mode adjustments */
  :global(html[data-theme="light"]) .aside--tip {
    --aside-bg: rgba(74, 222, 128, 0.15);
    --aside-title-color: #16a34a;
  }

  :global(html[data-theme="light"]) .aside--note {
    --aside-bg: rgba(45, 212, 191, 0.15);
    --aside-title-color: #0d9488;
  }

  :global(html[data-theme="light"]) .aside--caution {
    --aside-bg: rgba(251, 191, 36, 0.15);
    --aside-title-color: #d97706;
  }

  :global(html[data-theme="light"]) .aside--danger {
    --aside-bg: rgba(248, 113, 113, 0.15);
    --aside-title-color: #dc2626;
  }

  :global(html[data-theme="light"]) .aside--example {
    --aside-bg: rgba(192, 132, 252, 0.15);
    --aside-title-color: #9333ea;
  }

  :global(html[data-theme="light"]) .aside--video {
    --aside-bg: rgb(32, 148, 243, 0.12);
    --aside-title-color: rgb(32, 148, 243);
  }

  :global(html[data-theme="light"]) .aside-content {
    color: #374151;
  }

  

  :global(html[data-theme="light"]) .aside-content :global(p),
  :global(html[data-theme="light"]) .aside-content :global(li),
  :global(html[data-theme="light"]) .aside-content :global(figcaption) {
    color: #374151;
  }

  /* Ensure all text content inside asides uses Inter font */
  .aside-content,
  .aside-content :global(*) {
    font-family: 'Inter', system-ui, sans-serif;
  }

  /* Ensure images inside asides maintain aspect ratio */
  .aside-content :global(img) {
    max-width: 100%;
    height: auto !important;
    width: auto !important;
    object-fit: contain;
  }

  .aside-content :global(figure) {
    margin: 1rem 0;
    text-align: center;
  }

  .aside-content :global(figure img) {
    max-width: 100%;
    height: auto !important;
    width: auto !important;
    object-fit: contain;
    display: block;
    margin: 0 auto;
  }

  /* Iframe styling inside asides (Desmos, etc.) - exclude YouTube */
  .aside-content :global(iframe:not([src*="youtube"])) {
    width: 100%;
    max-width: 500px;
    aspect-ratio: 1 / 1;
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 0.5rem;
    display: block;
    margin: 0 auto;
  }

  /* YouTube videos inside asides - constrain size and center */
  .aside-content :global(.youtube-container) {
    margin: 0.75rem auto;
    width: 75%;
  }

  .aside-content :global(.youtube-wrapper) {
    max-width: 100%;
  }

  .aside-content :global(.youtube-wrapper iframe) {
    max-width: none;
    aspect-ratio: 16 / 9;
  }
</style>
