---
import { Icon } from '@astrojs/starlight/components';
import type { HTMLAttributes } from 'astro/types';
import { Image } from 'astro:assets';

interface Props extends Omit<HTMLAttributes<'a'>, 'title'> {
	title: string;
	description?: string;
    /** The image object imported from your relative folder */
    img?: ImageMetadata;
    /** Alt text for the image */
    imgAlt?: string;
}

const { title, description, img, imgAlt = "", ...attributes } = Astro.props;
---

<div class="sl-link-card">
    {img && (
        <div class="card-media">
            <Image src={img} alt={imgAlt} />
        </div>
    )}

    {img && <hr class="card-divider" />}

    <div class="card-content">
        {description && <div class="description" set:html={description} />}

        <div class="title-wrapper">
            <a {...attributes}>
                <span class="title" set:html={title} />
            </a>
            <Icon name="right-arrow" size="1.333em" class="icon rtl:flip" />
        </div>
    </div>
</div>

<style>
	@layer starlight.components {
		.sl-link-card {
            /* Change layout to Vertical (Flex Column) */
			display: flex;
            flex-direction: column;
			border: 1px solid var(--sl-color-gray-5);
			border-radius: 0.5rem;
			background-color: var(--sl-color-black);
			box-shadow: var(--sl-shadow-sm);
			position: relative;
            overflow: hidden; /* Ensures image corners stay rounded */
		}

		a {
			text-decoration: none;
			line-height: var(--sl-line-height-headings);
		}

		/* Make the whole card clickable */
		a::before {
			content: '';
			position: absolute;
			inset: 0;
            z-index: 1;
		}

        /* --- Image Styles --- */
        .card-media {
            width: 100%;
            /* Force 16:9 Aspect Ratio */
            aspect-ratio: 16 / 9;
            overflow: hidden;
        }

        .card-media img {
            width: 100%;
            height: 100%;
            /* Crop image to fill the 16:9 box */
            object-fit: cover; 
            display: block;
        }

        /* --- Horizontal Line --- */
        .card-divider {
            border: 0;
            border-top: 1px solid var(--sl-color-gray-5);
            margin: 0;
            width: 100%;
        }

        /* --- Content Layout --- */
        .card-content {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex-grow: 1;
        }

		.title-wrapper {
            /* Push title to the bottom if needed, or just keep flow */
            margin-top: auto; 
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
		}

		.title {
			color: var(--sl-color-white);
			font-weight: 600;
			font-size: var(--sl-text-lg);
		}

		.description {
			color: var(--sl-color-gray-3);
			line-height: 1.5;
		}

		.icon {
			color: var(--sl-color-gray-3);
		}

		/* Hover Effects */
		.sl-link-card:hover {
			background: var(--sl-color-gray-7, var(--sl-color-gray-6));
			border-color: var(--sl-color-gray-2);
		}

		.sl-link-card:hover .icon {
			color: var(--sl-color-white);
		}
	}
</style>